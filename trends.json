{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Monthly patronage trends by transport mode (2018–2025).",
  "config": {
    "font": "Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif",
    "axis": {"labelColor": "#333", "titleColor": "#333"},
    "legend": {"labelColor": "#333", "titleColor": "#333"}
  },
  
  "autosize": { "type": "fit", "contains": "padding" },
  "width": "container",
  "height": 400,

  "data": {
    "url": "data/monthly_public_transport_patronage_by_mode.csv",
    "format": {"type": "csv"}
  },

  "title": {"text": "Monthly Public Transport Patronage by Mode (2018–2025)", "anchor": "start"},

  "transform": [
    {
      "fold": [
        "Metropolitan train",
        "Metropolitan tram",
        "Metropolitan bus",
        "Regional train",
        "Regional coach",
        "Regional bus"
      ],
      "as": ["Mode", "Patronage"]
    },
    { "calculate": "toNumber(replace(datum.Patronage, ',', ''))", "as": "pax" },

    { "calculate": "datetime(datum.Year, datum.Month - 1, 1)", "as": "date" },

    { "filter": "isFinite(datum.pax)" }
  ],

  "params": [
    {
      "name": "modePick",
      "select": {"type": "point", "fields": ["Mode"]},
      "bind": "legend"
    }
  ],

  "mark": {
    "type": "line",
    "interpolate": "monotone",
    "strokeWidth": 2,
    "point": {"filled": true, "size": 20}
  },

  "encoding": {
    "x": {"field": "date", "type": "temporal", "title": "Month"},
    "y": {
      "field": "pax",
      "type": "quantitative",
      "title": "Monthly patronage",
      "axis": {"format": ","}
    },
    "color": {"field": "Mode", "type": "nominal", "title": "Mode"},
    "detail": {"field": "Mode"},
    "opacity": {"condition": {"param": "modePick", "value": 1}, "value": 0.2},
    "tooltip": [
      {"field": "Mode"},
      {"field": "Year"},
      {"field": "Month name", "title": "Month"},
      {"field": "pax", "title": "Patronage", "format": ","}
    ]
  }
}
